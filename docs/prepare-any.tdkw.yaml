stage: prepare
artifacts:
  library_metadata:
    summary: Holds metadata for a tandoku library.
    container: library
    location: library.tdkl.yaml
    sourceControl: text

  volume_metadata:
    summary: Holds metadata for a single tandoku volume.
    container: volume
    location: "{moniker} {title}.tdkv.yaml"
    sourceControl: text

  src_any_original:
    summary: Original source file in unsupported format, to be converted to supported format.
    container: volume
    location: source/{lang}/original
    sourceControl: binary
  src_any_investigate:
    summary: Source files to investigate.
    container: volume
    location: source/{lang}/investigate/
    sourceControl: binary
  src_any_unused:
    summary: Source files that are currently unused.
    container: volume
    location: source/{lang}/unused/
    sourceControl: binary

  initial_content:
    container: volume
  transformed_content:
    container: volume
  merged_content:
    container: volume
  tokenized_content:
    container: volume
  final_content:
    container: volume

  images:
    container: volume

  exported_markdown:
    container: volume
  exported_kindle_book:
    container: volume

simpleValues:
  src_language:
    summary: Auto (default), None or a language code
  src_folder:
    summary: empty (default), original, investigate, unused, ...

operations:
  wikipedia_lookup:
    outputs:
      - volume_title
      - original_media
  tandoku_volume_new:
    inputs:
      - volume_title
      - original_media
    outputs:
      - volume_metadata

  tandoku_source_import:
    summary: |-
      Copies files specified by importPath to volume source directory.
      Automatically infers language from *.{lang}.{ext} filename if language is auto.
    inputs:
      - volume_metadata
      - src_language
      - src_folder

  tandoku_content_merge:
    inputs:
      - transformed_content
    outputs:
      - merged_content
  tandoku_content_finalize:
    #TODO: this is template specific, should just be defined in specific templates?
    #inputs:
    #  - merged_content
    outputs:
      - final_content
  tandoku_content_tokenize:
    inputs:
      - final_content
    outputs:
       - tokenized_content

  tandoku_markdown_export:
    inputs:
      - final_content
      - images
    outputs:
      - exported_markdown
  tandoku_kindle_generate:
    inputs:
      - exported_markdown
    outputs:
      - exported_kindle_book