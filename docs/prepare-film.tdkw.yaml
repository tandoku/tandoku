stage: prepare
media: film
artifacts:
  src_subtitle:
    summary: |-
      Subtitle file added to volume with no changes to name or content.
      May or may not include language in filename (e.g. subtitle.ja.srt).
    container: volume
    location: source/{lang}/
    sourceControl: binary
  initial_subtitle:
    summary: |-
      Subtitle file renamed according to volume slug.
      Always includes language in filename (e.g. subtitle.ja.srt).
    container: volume
    location: subtitles/initial/
    sourceControl: text
  clean_subtitle:
    container: volume
  aligned_subtitle:
    container: volume
  final_subtitle:
    container: volume

  src_video:
    container: volume
    location: source/
    sourceControl: binary
  initial_video:
    summary: |-
      Video file renamed according to volume slug.
    container: volume
    location: video/initial/
    sourceControl: binary
  clean_video:
    container: volume
  final_video:
    container: volume

  exported_video:
    container: staging
  exported_subtitles:
    container: staging

  subs2cia_subtitle:
    container: volume
  temp_subs2cia_tsv:
    container: volume
  temp_audio_clips:
    container: volume
  temp_images:
    container: volume
  subs2cia_content:
    container: volume

simpleValues:
  src_language:
    summary: Auto (default), None or a language code
  src_folder:
    summary: empty (default), original, investigate, unused, ...
operations:
  # TODO: this should move to prepare-any
  tandoku_source_import:
    summary: |-
      Copies files specified by importPath to volume source directory.
      Automatically infers language from *.{lang}.{ext} filename if language is auto.
    inputs:
      - volume_tdkv
      - external_subtitle
      - external_video
      - src_language
      - src_folder
    outputs:
      - src_subtitle
      - src_video

  tandoku_subtitles_init:
    inputs:
      - volume_tdkv
      - src_subtitle
    outputs:
      - initial_subtitle
  tandoku_subtitles_clean:
    inputs:
      - initial_subtitle
    outputs:
      - clean_subtitle
  tandoku_subtitles_align:
    inputs:
      - clean_subtitle
      - final_video
    outputs:
      - aligned_subtitle
  tandoku_subtitles_finalize:
    inputs:
      - aligned_subtitle
    outputs:
      - final_subtitle
  tandoku_subtitles_contentgen:
    inputs:
      - final_subtitle
    outputs:
      - initial_content

  tandoku_subtitles_subs2cia_export: {}
  tandoku_subtitles_subs2cia_process: {}
  tandoku_subtitles_subs2cia_import: {}

  tandoku_video_init:
    inputs:
      - volume_tdkv
      - src_video
    outputs:
      - initial_video
  tandoku_video_clean:
    inputs:
      - initial_video
    outputs:
      - clean_video
  tandoku_video_finalize:
    inputs:
      - clean_video
    outputs:
      - final_video
  tandoku_video_export:
    inputs:
      - final_subtitle
      - final_video
    outputs:
      - exported_video
      - exported_subtitles

  tandoku_content_transform_film:
    inputs:
       - initial_content
    outputs:
      - transformed_content