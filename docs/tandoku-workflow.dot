digraph {
    graph [fontname="Helvetica"];
    node [fontname="Helvetica" penwidth=0.2];
    edge [fontname="Helvetica" arrowsize="0.6"];

    # processes
    node [shape=rect style="filled" fillcolor=blue fontcolor=white];
    tandoku_new_volume

    tandoku_export_tokens_csv

    ## film processes
    tandoku_subtitles_import
    tandoku_subtitles_rename
    tandoku_subtitles_clean
    tandoku_subtitles_align
    tandoku_subtitles_finalize
    tandoku_subtitles_contentgen

    tandoku_video_import
    tandoku_video_rename
    tandoku_video_clean
    tandoku_video_finalize
    tandoku_video_export

    tandoku_transform_film

    tandoku_subtitles_exportcia
    tandoku_subtitles_subs2cia
    tandoku_subtitles_importcia

    ## general content processes
    tandoku_merge
    tandoku_tokenize
    tandoku_finalize

    ## markdown, kindle export processses
    tandoku_export_markdown
    tandoku_kindle_generate

    # artifacts
    node [shape=rect style="filled,rounded" fillcolor=orange];
    volume_tdkv

    raw_content
    transformed_content
    merged_content
    tokenized_content
    final_content

    images

    audio_clips

    tokens_csv

    ## film artifacts
    external_subtitle
    src_subtitle
    renamed_subtitle
    clean_subtitle
    aligned_subtitle
    final_subtitle

    external_video
    src_video
    renamed_video
    clean_video
    final_video

    exported_video
    exported_subtitles

    cia_subtitle
    temp_subs2cia_tsv
    temp_audio_clips
    temp_images
    cia_content

    ## exported markdown, kindle
    exported_markdown
    exported_kindle_book

    # user input
    node [shape=rect style="filled,rounded" fillcolor=green];
    volume_input

    # edges
    volume_input -> tandoku_new_volume
    tandoku_new_volume -> volume_tdkv

    tokenized_content -> tandoku_export_tokens_csv
    tandoku_export_tokens_csv -> tokens_csv

    ## film edges
    external_subtitle -> tandoku_subtitles_import
    volume_tdkv -> tandoku_subtitles_import
    tandoku_subtitles_import -> src_subtitle
    src_subtitle -> tandoku_subtitles_rename
    volume_tdkv -> tandoku_subtitles_rename
    tandoku_subtitles_rename -> renamed_subtitle
    renamed_subtitle -> tandoku_subtitles_clean
    tandoku_subtitles_clean -> clean_subtitle

    external_video -> tandoku_video_import
    volume_tdkv -> tandoku_video_import
    tandoku_video_import -> src_video
    src_video -> tandoku_video_rename
    volume_tdkv -> tandoku_video_rename
    tandoku_video_rename -> renamed_video
    renamed_video -> tandoku_video_clean
    tandoku_video_clean -> clean_video
    clean_video -> tandoku_video_finalize
    tandoku_video_finalize -> final_video

    clean_subtitle -> tandoku_subtitles_align
    final_video -> tandoku_subtitles_align
    tandoku_subtitles_align -> aligned_subtitle
    aligned_subtitle -> tandoku_subtitles_finalize
    tandoku_subtitles_finalize -> final_subtitle

    final_subtitle -> tandoku_video_export
    final_video -> tandoku_video_export
    tandoku_video_export -> exported_video
    tandoku_video_export -> exported_subtitles

    final_subtitle -> tandoku_subtitles_contentgen
    tandoku_subtitles_contentgen -> raw_content

    raw_content -> tandoku_transform_film
    tandoku_transform_film -> transformed_content

    merged_content -> tandoku_subtitles_exportcia
    tandoku_subtitles_exportcia -> cia_subtitle
    cia_subtitle -> tandoku_subtitles_subs2cia
    final_video -> tandoku_subtitles_subs2cia
    tandoku_subtitles_subs2cia -> temp_audio_clips
    tandoku_subtitles_subs2cia -> temp_images
    tandoku_subtitles_subs2cia -> temp_subs2cia_tsv
    temp_audio_clips -> tandoku_subtitles_importcia
    temp_images -> tandoku_subtitles_importcia
    temp_subs2cia_tsv -> tandoku_subtitles_importcia
    tandoku_subtitles_importcia -> audio_clips
    tandoku_subtitles_importcia -> images
    tandoku_subtitles_importcia -> cia_content

    cia_content -> tandoku_finalize

    ## general content edges
    transformed_content -> tandoku_merge
    tandoku_merge -> merged_content
    merged_content -> tandoku_finalize
    tandoku_finalize -> final_content

    final_content -> tandoku_tokenize
    tandoku_tokenize -> tokenized_content

    ## markdown export
    final_content -> tandoku_export_markdown
    images -> tandoku_export_markdown
    tandoku_export_markdown -> exported_markdown

    ## kindle export
    exported_markdown -> tandoku_kindle_generate
    tandoku_kindle_generate -> exported_kindle_book
}